<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Panel de Control ‚Äî Latam5S</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuraci√≥n de Tailwind para usar colores y fuentes personalizados
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent': '#D96B4F', // El color principal (Terracota)
                        'accent-alt': '#FF8B6A', // El color secundario (Naranja claro)
                        'bg-soft': '#fffaf6', // El color de fondo original
                        'badge-pending': '#9a6200',
                        'badge-sent': '#D96B4F',
                        'badge-delivered': '#1b7f3a',
                        'badge-rescheduled': '#8e44ad',
                        // Se a√±ade 'brand-accent' para que coincida con la clase del h√©roe
                        'brand-accent': '#D96B4F', 
                    },
                    fontFamily: {
                        sans: ['Quicksand', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Arial', 'sans-serif'],
                    },
                    borderRadius: {
                        'xl': '14px', // Mantenemos el radio de borde original
                    }
                },
            }
        }
    </script>
    <style>
        /* Estilos base (M√≠nimo CSS necesario) */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { background-color: #fffaf6; color: #2b2b2b; line-height: 1.6; }

        /* Clases de utilidad */
        .oculto { display: none !important; }

        /* Manejo de secciones (ya no lo hace el CSS, sino el JS que a√±ade 'active') */
        main > section { display: none; }
        main > section.active { display: block; }

        /* Estilos espec√≠ficos para la tabla (para manejar el nowrap y el ancho) */
        .nowrap { white-space: nowrap; }
    </style>
</head>
<body class="font-sans bg-bg-soft text-gray-900 antialiased">
    <!-- ---------- HEADER ---------- -->
    <header class="bg-gradient-to-br from-brand-accent to-orange-400 text-white p-6 shadow-xl shadow-accent/25 flex items-center justify-center md:justify-start gap-4">
        <img id="headerLogo" src="" alt="Logo Emprendimiento" class="h-12 w-12 rounded-lg object-cover bg-white p-1 hidden">
        <div>
            <h1 id="headerTitle" class="text-2xl font-bold">üìã Panel de Control</h1>
            <p class="mt-1 text-sm opacity-90">Bienvenido, <strong id="headerBusinessName">[Nombre del emprendimiento]</strong></p>
        </div>
    </header>

    <!-- ---------- NAV ---------- -->
    <nav class="bg-white/80 backdrop-blur-sm border-b border-gray-200 flex flex-wrap gap-1 p-3 sticky top-0 z-10 justify-center">
        <a href="#envios" class="nav-link active text-gray-500 font-semibold text-sm transition-colors p-2.5 rounded-lg flex items-center gap-1.5 
            hover:text-gray-900 w-full justify-center sm:w-auto 
            active:bg-orange-100 active:text-accent sm:active:text-accent">
            <i data-feather="truck" class="w-4 h-4"></i>Env√≠os
        </a>
        <a href="#link" class="nav-link text-gray-500 font-semibold text-sm transition-colors p-2.5 rounded-lg flex items-center gap-1.5 
            hover:text-gray-900 w-full justify-center sm:w-auto">
            <i data-feather="link" class="w-4 h-4"></i>Link M√°gico
        </a>
        <a href="#reportes" class="nav-link text-gray-500 font-semibold text-sm transition-colors p-2.5 rounded-lg flex items-center gap-1.5 
            hover:text-gray-900 w-full justify-center sm:w-auto">
            <i data-feather="bar-chart-2" class="w-4 h-4"></i>Reportes
        </a>
        <a href="#cuenta" class="nav-link text-gray-500 font-semibold text-sm transition-colors p-2.5 rounded-lg flex items-center gap-1.5 
            hover:text-gray-900 w-full justify-center sm:w-auto">
            <i data-feather="settings" class="w-4 h-4"></i>Mi Cuenta
        </a>
    </nav>

    <main class="p-6 max-w-7xl mx-auto">
        
        <!-- ======================= SECCI√ìN ENV√çOS ======================= -->
        <section class="active" id="envios">
            <div class="card bg-white rounded-xl shadow-lg shadow-gray-100 p-6 border border-gray-200 mb-6">
                <h2 class="text-2xl font-bold text-accent mb-4 flex items-center gap-2">
                    <i data-feather="truck" class="w-6 h-6"></i>Mis Env√≠os
                </h2>
                
                <!-- Acciones Principales -->
                <div class="flex gap-2 flex-wrap justify-end mb-4">
                    <button class="btn ghost bg-transparent border border-gray-200 text-gray-900 hover:bg-gray-50 transition-all duration-200 py-2.5 px-4 rounded-xl font-bold text-sm inline-flex items-center gap-2" id="btnTplShalom"><i data-feather="download" class="w-4 h-4"></i>Plantilla SHALOM</button>
                    <button class="btn ghost bg-transparent border border-gray-200 text-gray-900 hover:bg-gray-50 transition-all duration-200 py-2.5 px-4 rounded-xl font-bold text-sm inline-flex items-center gap-2" id="btnTplOlva"><i data-feather="download" class="w-4 h-4"></i>Plantilla OLVA</button>
                    <button class="btn primary bg-gradient-to-r from-accent to-accent-alt text-white shadow-md shadow-accent/20 hover:shadow-lg hover:shadow-accent/30 hover:-translate-y-0.5 transition-all duration-200 py-2.5 px-4 rounded-xl font-bold text-sm inline-flex items-center gap-2" id="btnEtiquetas"><i data-feather="tag" class="w-4 h-4"></i>Imprimir Etiquetas</button>
                </div>
                
                <!-- Filtros -->
                <div class="flex flex-wrap items-center gap-3 my-4">
                    <label class="text-xs text-gray-500 font-semibold">Cliente (Celular)<input type="text" id="filtroCliente" placeholder="Ej: 987654321" class="input p-2.5 border border-gray-200 rounded-xl bg-white w-40 text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100 mt-1" /></label>
                    <label class="text-xs text-gray-500 font-semibold">Fecha de Env√≠o<input type="date" id="filtroFecha" class="input p-2.5 border border-gray-200 rounded-xl bg-white w-40 text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100 mt-1" /></label>
                    <label class="text-xs text-gray-500 font-semibold">Courier
                        <select id="filtroTipo" class="select p-2.5 border border-gray-200 rounded-xl bg-white w-40 text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100 mt-1">
                            <option value="">Todos</option>
                            <option value="DELIVERY">Delivery Propio</option>
                            <option value="SHALOM">Shalom</option>
                            <option value="OLVA">Olva</option>
                        </select>
                    </label>
                    <button class="btn primary bg-gradient-to-r from-accent to-accent-alt text-white py-2.5 px-4 rounded-xl font-bold text-sm h-fit self-end shadow-md shadow-accent/20 hover:shadow-lg hover:shadow-accent/30 hover:-translate-y-0.5 transition-all duration-200" id="btnAplicarFiltros">Filtrar</button>
                </div>
                
                <!-- Lote y Selecci√≥n -->
                <div class="flex flex-wrap items-center justify-between gap-3 my-3">
                    <div class="lote-left flex gap-3 items-center flex-wrap">
                        <label class="nowrap text-sm text-gray-900"><input type="checkbox" id="checkTodos" class="rounded border-gray-300 text-accent focus:ring-accent" /> Seleccionar todo</label>
                        <span class="text-gray-500 text-sm" id="selCount">0 seleccionados</span>
                    </div>
                    <div class="lote-right flex gap-2 items-center flex-wrap justify-end">
                        <select id="accionLote" class="select p-2.5 border border-gray-200 rounded-xl bg-white w-40 text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100">
                            <option value="" selected>Acci√≥n en lote‚Ä¶</option>
                            <option value="ENVIADO">Marcar como Enviado</option>
                            <option value="ENTREGADO">Marcar como Entregado</option>
                            <option value="REPROGRAMADO">Reprogramar</option>
                        </select>
                        <input type="date" id="fechaReprog" class="input p-2.5 border border-gray-200 rounded-xl bg-white w-40 text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100 oculto" />
                        <button class="btn primary bg-accent text-white py-2.5 px-4 rounded-xl font-bold text-sm shadow-md shadow-accent/20 hover:shadow-lg hover:shadow-accent/30 hover:-translate-y-0.5 transition-all duration-200" id="btnAplicarLote">Aplicar</button>
                    </div>
                </div>
                
                <!-- Tabla de Env√≠os -->
                <div class="overflow-x-auto shadow-lg shadow-gray-100 rounded-xl border border-gray-200">
                    <table id="tablaEnvios" class="w-full border-collapse bg-white">
                        <thead>
                            <tr>
                                <th class="border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50 rounded-tl-xl w-12"><input type="checkbox" id="thCheckTodos" class="rounded border-gray-300 text-accent focus:ring-accent" /></th>
                                <th class="border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Fecha Reg.</th>
                                <th class="border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Cliente</th>
                                <th class="border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Courier</th>
                                <th class="border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Destinatario</th>
                                <th class="col-distrito border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Distrito</th>
                                <th class="col-direccion border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Direcci√≥n</th>
                                <th class="col-dni border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">DNI/CE</th>
                                <th class="col-agencia border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Agencia</th>
                                <th class="border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50">Fecha Env√≠o</th>
                                <th class="border-t border-gray-200 p-3 text-left text-xs font-bold text-accent uppercase tracking-wider bg-orange-50 rounded-tr-xl">Estado</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyEnvios">
                            <!-- JS llenar√° esta tabla -->
                            <tr><td colspan="11" class="text-center p-10 text-gray-500">No hay env√≠os para mostrar.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ======================= SECCI√ìN LINK M√ÅGICO ======================= -->
        <section id="link">
            <div class="card bg-white rounded-xl shadow-lg shadow-gray-100 p-6 border border-gray-200 mb-6">
                <h2 class="text-2xl font-bold text-accent mb-4 flex items-center gap-2">
                    <i data-feather="link" class="w-6 h-6"></i>Tu Enlace M√°gico
                </h2>
                <p class="text-gray-500 text-sm mb-5">Comparte este link √∫nico con tus clientes. Ellos completar√°n sus datos de env√≠o directamente y la informaci√≥n aparecer√° en tu panel, ¬°sin errores y sin que tengas que transcribir nada!</p>
                <div class="form-group">
                    <label for="linkUnicoInput" class="block text-sm text-gray-500 font-semibold mb-1.5">Tu enlace personal</label>
                    <div id="linkUnicoContainer" class="flex gap-2">
                        <input type="text" id="linkUnicoInput" class="input p-2.5 border border-gray-200 rounded-xl bg-gray-50 flex-grow text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100" value="https://latam5s.com/form/tu-tienda" readonly>
                        <button class="btn primary bg-gradient-to-r from-accent to-accent-alt text-white shadow-md shadow-accent/20 hover:shadow-lg hover:shadow-accent/30 hover:-translate-y-0.5 transition-all duration-200 py-2.5 px-4 rounded-xl font-bold text-sm inline-flex items-center gap-2" id="btnCopiarLink"><i data-feather="copy" class="w-4 h-4"></i>Copiar</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ======================= SECCI√ìN REPORTES ======================= -->
        <section id="reportes">
            <div class="card bg-white rounded-xl shadow-lg shadow-gray-100 p-6 border border-gray-200 mb-6">
                <h2 class="text-2xl font-bold text-accent mb-4 flex items-center gap-2">
                    <i data-feather="bar-chart-2" class="w-6 h-6"></i>Reportes (Este Mes)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
                    <div class="stat-card text-center bg-bg-soft p-5 rounded-xl border border-orange-100">
                        <div class="value text-4xl font-bold text-accent" id="statTotal">128</div>
                        <div class="label text-sm text-gray-500 mt-1">Env√≠os Totales</div>
                    </div>
                    <div class="stat-card text-center bg-bg-soft p-5 rounded-xl border border-orange-100">
                        <div class="value text-4xl font-bold text-accent" id="statPendientes">15</div>
                        <div class="label text-sm text-gray-500 mt-1">Pendientes</div>
                    </div>
                    <div class="stat-card text-center bg-bg-soft p-5 rounded-xl border border-orange-100">
                        <div class="value text-4xl font-bold text-accent" id="statCompletados">113</div>
                        <div class="label text-sm text-gray-500 mt-1">Completados</div>
                    </div>
                    <div class="stat-card text-center bg-bg-soft p-5 rounded-xl border border-orange-100">
                        <div class="value text-2xl font-bold text-accent" id="statCourier">Shalom</div>
                        <div class="label text-sm text-gray-500 mt-1">Courier M√°s Usado</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ======================= SECCI√ìN MI CUENTA ======================= -->
        <section id="cuenta">
            <h2 class="text-2xl font-bold text-accent mb-4 flex items-center gap-2">
                <i data-feather="settings" class="w-6 h-6"></i>Configuraci√≥n de tu Cuenta
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
                <div class="card setting-card bg-white rounded-xl shadow-lg shadow-gray-100 p-6 border border-gray-200 flex flex-col gap-4">
                    <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i data-feather="briefcase" class="w-5 h-5 text-accent"></i> Perfil del Negocio</h3>
                    <div class="form-group">
                        <label for="businessName" class="block text-sm text-gray-500 font-semibold mb-1.5">Nombre del Emprendimiento</label>
                        <input type="text" id="businessName" class="input p-2.5 border border-gray-200 rounded-xl bg-white w-full text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100" placeholder="Ej: La Tiendita de Ana">
                    </div>
                    <div class="form-group">
                        <label for="logoInput" class="block text-sm text-gray-500 font-semibold mb-1.5">Logo del Negocio</label>
                        <input type="file" id="logoInput" class="input p-2.5 border border-gray-200 rounded-xl bg-white w-full text-sm file:mr-4 file:py-1 file:px-2 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-accent hover:file:bg-orange-100" accept="image/*">
                        <img id="logoPreview" src="" alt="Vista previa del logo" class="max-h-20 rounded-lg object-contain border border-dashed border-gray-300 p-1 mt-3 hidden">
                    </div>
                </div>

                <div class="card setting-card bg-white rounded-xl shadow-lg shadow-gray-100 p-6 border border-gray-200 flex flex-col gap-4">
                    <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i data-feather="package" class="w-5 h-5 text-accent"></i> Opciones de Env√≠o</h3>
                    <p class="text-sm text-gray-500">Selecciona los couriers que ofreces. Tus clientes solo ver√°n estas opciones en el formulario.</p>
                    <div class="form-group space-y-2">
                        <label class="block text-sm text-gray-900"><input type="checkbox" checked class="rounded border-gray-300 text-accent focus:ring-accent mr-2"> Delivery Propio</label>
                        <label class="block text-sm text-gray-900"><input type="checkbox" checked class="rounded border-gray-300 text-accent focus:ring-accent mr-2"> Shalom</label>
                        <label class="block text-sm text-gray-900"><input type="checkbox" class="rounded border-gray-300 text-accent focus:ring-accent mr-2"> Olva</label>
                        <label class="block text-sm text-gray-900"><input type="checkbox" class="rounded border-gray-300 text-accent focus:ring-accent mr-2" disabled> Otro (pr√≥ximamente)</label>
                    </div>
                </div>

                <div class="card setting-card bg-white rounded-xl shadow-lg shadow-gray-100 p-6 border border-gray-200 flex flex-col gap-4">
                    <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i data-feather="calendar" class="w-5 h-5 text-accent"></i> Fechas y Horarios</h3>
                    <div class="form-group">
                        <label for="cutoffTime" class="block text-sm text-gray-500 font-semibold mb-1.5">Hora de Cierre de Pedidos</label>
                        <input type="time" id="cutoffTime" class="input p-2.5 border border-gray-200 rounded-xl bg-white w-full text-sm focus:outline-none focus:border-accent focus:ring-3 focus:ring-orange-100">
                    </div>
                    <div class="form-group">
                        <label class="block text-sm text-gray-500 font-semibold mb-1.5">D√≠as de Despacho Habilitados</label>
                        <div class="flex flex-wrap gap-2 text-sm">
                            <label class="inline-flex items-center"><input type="checkbox" class="rounded border-gray-300 text-accent focus:ring-accent mr-1"> Lun</label>
                            <label class="inline-flex items-center"><input type="checkbox" checked class="rounded border-gray-300 text-accent focus:ring-accent mr-1"> Mar</label>
                            <label class="inline-flex items-center"><input type="checkbox" class="rounded border-gray-300 text-accent focus:ring-accent mr-1"> Mi√©</label>
                            <label class="inline-flex items-center"><input type="checkbox" checked class="rounded border-gray-300 text-accent focus:ring-accent mr-1"> Jue</label>
                            <label class="inline-flex items-center"><input type="checkbox" class="rounded border-gray-300 text-accent focus:ring-accent mr-1"> Vie</label>
                            <label class="inline-flex items-center"><input type="checkbox" checked class="rounded border-gray-300 text-accent focus:ring-accent mr-1"> S√°b</label>
                            <label class="inline-flex items-center"><input type="checkbox" class="rounded border-gray-300 text-accent focus:ring-accent mr-1"> Dom</label>
                        </div>
                    </div>
                </div>

                <div class="card setting-card bg-white rounded-xl shadow-lg shadow-gray-100 p-6 border border-gray-200 flex flex-col gap-4">
                    <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i data-feather="users" class="w-5 h-5 text-accent"></i> Gesti√≥n de Equipo</h3>
                    <p class="text-sm text-gray-500">Invita a miembros de tu equipo para gestionar los env√≠os (Funci√≥n del Plan Consolidado).</p>
                    <button class="btn ghost bg-transparent border border-gray-200 text-gray-500 py-2.5 px-4 rounded-xl font-bold text-sm inline-flex items-center gap-2 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200" disabled><i data-feather="plus" class="w-4 h-4"></i>Invitar Usuario</button>
                </div>
            </div>
            <div class="flex justify-end mt-5">
                <button class="btn primary bg-gradient-to-r from-accent to-accent-alt text-white shadow-md shadow-accent/20 hover:shadow-lg hover:shadow-accent/30 hover:-translate-y-0.5 transition-all duration-200 py-2.5 px-4 rounded-xl font-bold text-sm inline-flex items-center gap-2" id="btnGuardarConfig"><i data-feather="save" class="w-4 h-4"></i>Guardar Cambios</button>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="mt-20 pb-5 flex justify-center items-center gap-2 text-gray-500 text-sm">
            <span>Powered by</span>
            <svg height="20" viewBox="0 0 90 22" xmlns="http://www.w3.org/2000/svg">
                <text x="0" y="18" style="font-family: Quicksand, sans-serif; font-size: 20px; font-weight: 700; fill: #D96B4F;">Latam5S</text>
            </svg>
        </footer>
    </main>

    <!-- Toast de Notificaci√≥n -->
    <div class="toast fixed right-5 bottom-5 bg-gradient-to-r from-accent to-accent-alt text-white p-3 rounded-xl shadow-xl shadow-accent/25 opacity-0 translate-y-2 transition-all duration-300 z-50" id="toast">Acci√≥n aplicada</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Inicializa Feather Icons
    feather.replace();

    // --- NAVEGACI√ìN PRINCIPAL ---
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('main > section');

    // Funci√≥n para manejar la navegaci√≥n entre secciones
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href').substring(1);
            
            navLinks.forEach(l => {
                l.classList.remove('active', 'bg-orange-100', 'text-accent');
                l.classList.add('text-gray-500');
            });
            
            // Aplica clases de Tailwind para el estado activo
            link.classList.add('active', 'bg-orange-100', 'text-accent');
            link.classList.remove('text-gray-500');


            sections.forEach(sec => {
                sec.classList.toggle('active', sec.id === targetId);
            });
        });
    });

    // Inicializa la primera secci√≥n como activa visualmente
    document.querySelector('.nav-link.active').classList.add('bg-orange-100', 'text-accent');
    document.querySelector('.nav-link.active').classList.remove('text-gray-500');

    // --- SECCI√ìN ENV√çOS (Variables de DOM) ---
    const filtroTipo = document.getElementById('filtroTipo');
    const filtroCliente = document.getElementById('filtroCliente');
    const filtroFecha = document.getElementById('filtroFecha');
    const btnAplicarFiltros = document.getElementById('btnAplicarFiltros');
    const tbody = document.getElementById('tbodyEnvios');
    const checkTodos = document.getElementById('checkTodos');
    const thCheckTodos = document.getElementById('thCheckTodos');
    const selCount = document.getElementById('selCount');
    const accionLote = document.getElementById('accionLote');
    const fechaReprog = document.getElementById('fechaReprog');
    const btnAplicarLote = document.getElementById('btnAplicarLote');
    
    // Datos de ejemplo
    const sampleData = [
        { id: 1, tipo: "SHALOM", cliente: "912345678", fechaEnvio: "2025-08-20", fechaReg: "2025-08-18", nombre: "Mar√≠a L√≥pez", dni: "87654321", agencia: "Lima / Lima / Chorrillos", estado: "ENVIADO" },
        { id: 2, tipo: "DELIVERY", cliente: "987654321", fechaEnvio: "2025-08-22", fechaReg: "2025-08-20", nombre: "Juan P√©rez", distrito: "Miraflores", direccion: "Av. Principal 123", estado: "PENDIENTE" },
        { id: 3, tipo: "OLVA", cliente: "911223344", fechaEnvio: "2025-08-25", fechaReg: "2025-08-22", nombre: "Luc√≠a Guti√©rrez", dni: "75342190", agencia: "Lima / Lima / Los Olivos", estado: "PENDIENTE" },
        { id: 4, tipo: "DELIVERY", cliente: "987111222", fechaEnvio: "2025-08-26", fechaReg: "2025-08-23", nombre: "Rosa Valdivia", distrito: "San Miguel", direccion: "Av. Universitaria 240", estado: "ENTREGADO" },
        { id: 5, tipo: "SHALOM", cliente: "988667755", fechaEnvio: "2025-08-29", fechaReg: "2025-08-26", nombre: "Valeria Campos", dni: "78451236", agencia: "Piura / Piura / Castilla", estado: "REPROGRAMADO" },
    ];
    
    // Funci√≥n para renderizar la tabla
    function renderTable(data) {
        tbody.innerHTML = '';
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="11" class="text-center p-10 text-gray-500">No hay env√≠os que coincidan con los filtros.</td></tr>';
            return;
        }

        data.forEach(item => {
            const row = document.createElement('tr');
            row.classList.add('hover:bg-orange-50', 'transition-colors');
            row.dataset.id = item.id;
            row.dataset.tipo = item.tipo;
            row.dataset.cliente = item.cliente;
            row.dataset.fechaenvio = item.fechaEnvio;
            
            // Mapeo de estados a clases Tailwind para los badges
            const badgeClassMap = {
                "PENDIENTE": 'bg-amber-100 text-badge-pending border-amber-300',
                "ENVIADO": 'bg-orange-100 text-badge-sent border-orange-300',
                "ENTREGADO": 'bg-emerald-100 text-badge-delivered border-emerald-300',
                "REPROGRAMADO": 'bg-purple-100 text-badge-rescheduled border-purple-300',
            };
            const estadoBadge = `<span class="badge ${badgeClassMap[item.estado]} px-2 py-1 rounded-full text-xs font-bold border">${item.estado}</span>`;

            row.innerHTML = `
                <td class="border-t border-gray-200 p-3"><input type="checkbox" class="rowCheck rounded border-gray-300 text-accent focus:ring-accent" /></td>
                <td class="border-t border-gray-200 p-3 text-xs text-gray-700 nowrap">${item.fechaReg}</td>
                <td class="border-t border-gray-200 p-3 text-xs text-gray-700">${item.cliente}</td>
                <td class="border-t border-gray-200 p-3 text-xs text-gray-700">${item.tipo}</td>
                <td class="border-t border-gray-200 p-3 text-xs text-gray-700">${item.nombre}</td>
                <td class="col-distrito border-t border-gray-200 p-3 text-xs text-gray-700">${item.distrito || '-'}</td>
                <td class="col-direccion border-t border-gray-200 p-3 text-xs text-gray-700">${item.direccion || '-'}</td>
                <td class="col-dni border-t border-gray-200 p-3 text-xs text-gray-700">${item.dni || '-'}</td>
                <td class="col-agencia border-t border-gray-200 p-3 text-xs text-gray-700">${item.agencia || '-'}</td>
                <td class="border-t border-gray-200 p-3 text-xs text-gray-700 nowrap">${item.fechaEnvio}</td>
                <td class="estado border-t border-gray-200 p-3">${estadoBadge}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Funci√≥n principal de filtros y visibilidad de columnas
    function aplicarFiltros() {
        const tipo = filtroTipo.value;
        const cel = filtroCliente.value.trim().toLowerCase();
        const fecha = filtroFecha.value;
        
        // 1. Filtrar los datos primero
        const filteredData = sampleData.filter(item => {
            const okTipo = !tipo || item.tipo === tipo;
            const okCli = !cel || item.cliente.includes(cel);
            const okFec = !fecha || item.fechaEnvio === fecha;
            return okTipo && okCli && okFec;
        });
        
        // 2. Renderizar la tabla con los datos filtrados
        renderTable(filteredData);
        
        // 3. Ahora, aplicar la visibilidad de columnas a la tabla reci√©n renderizada
        const colDistrito = document.querySelectorAll('.col-distrito');
        const colDireccion = document.querySelectorAll('.col-direccion');
        const colDni = document.querySelectorAll('.col-dni');
        const colAgencia = document.querySelectorAll('.col-agencia');

        // Resetear visibilidad
        [...colDistrito, ...colDireccion, ...colDni, ...colAgencia].forEach(el => el.style.display = 'table-cell');
        
        // Aplicar reglas de visibilidad seg√∫n Courier
        if (tipo === 'DELIVERY') { 
            [...colDni, ...colAgencia].forEach(el => el.style.display = 'none'); 
        } else if (tipo === 'SHALOM' || tipo === 'OLVA') { 
            [...colDistrito, ...colDireccion].forEach(el => el.style.display = 'none'); 
        }

        // 4. Deseleccionar todas las filas
        deseleccionarTodo();
    }

    // Funciones de selecci√≥n en lote
    function contarSeleccionados(){
        const count = tbody.querySelectorAll('.rowCheck:checked').length;
        selCount.textContent = `${count} seleccionados`;
    }
    function seleccionarTodo(checked){
        tbody.querySelectorAll('.rowCheck').forEach(cb => cb.checked = checked);
        thCheckTodos.checked = checked;
        checkTodos.checked = checked;
        contarSeleccionados();
    }
    function deseleccionarTodo(){ seleccionarTodo(false); }

    // Eventos de selecci√≥n
    checkTodos.addEventListener('change', e => seleccionarTodo(e.target.checked));
    thCheckTodos.addEventListener('change', e => seleccionarTodo(e.target.checked));
    tbody.addEventListener('change', e => { if(e.target.classList.contains('rowCheck')) contarSeleccionados(); });
    
    // Evento de acci√≥n en lote
    accionLote.addEventListener('change', () => {
        fechaReprog.classList.toggle('oculto', accionLote.value !== 'REPROGRAMADO');
        if (accionLote.value !== 'REPROGRAMADO') fechaReprog.value = '';
    });

    // Evento de aplicar acci√≥n en lote
    btnAplicarLote.addEventListener('click', () => {
        const action = accionLote.value;
        if (!action){ showToast('Elige una acci√≥n en lote'); return; }
        if (action === 'REPROGRAMADO' && !fechaReprog.value){ showToast('Selecciona fecha para reprogramar'); return; }
        const seleccionados = [...tbody.querySelectorAll('.rowCheck:checked')];
        if (seleccionados.length === 0){ showToast('No hay env√≠os seleccionados'); return; }
        
        const selectedIds = seleccionados.map(cb => parseInt(cb.closest('tr').dataset.id, 10));

        // Actualizar los datos en el array principal
        selectedIds.forEach(id => {
            const item = sampleData.find(d => d.id === id);
            if (item) {
                if (action === 'REPROGRAMADO') {
                    item.estado = 'REPROGRAMADO';
                    item.fechaEnvio = fechaReprog.value;
                } else {
                    item.estado = action; // Aplica ENVIADO o ENTREGADO
                }
            }
        });

        showToast(`Acci√≥n aplicada a ${seleccionados.length} env√≠o(s)`);
        
        // Refrescar la tabla para mostrar los cambios
        aplicarFiltros();
    });
    
    btnAplicarFiltros.addEventListener('click', aplicarFiltros);

    // --- SECCI√ìN LINK M√ÅGICO ---
    const btnCopiarLink = document.getElementById('btnCopiarLink');
    const linkUnicoInput = document.getElementById('linkUnicoInput');
    
    // Uso de navigator.clipboard.writeText para copiar
    btnCopiarLink.addEventListener('click', () => {
        // Fallback for secure context (Canvas environment)
        if (!navigator.clipboard || !navigator.clipboard.writeText) {
            // Fallback for non-secure or restricted contexts
            const textarea = document.createElement('textarea');
            textarea.value = linkUnicoInput.value;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showToast('¬°Enlace copiado al portapapeles!');
            } catch (err) {
                showToast('Error al copiar: Tu navegador no lo permite.');
            }
            document.body.removeChild(textarea);

        } else {
            // Modern Clipboard API
            navigator.clipboard.writeText(linkUnicoInput.value).then(() => {
                showToast('¬°Enlace copiado al portapapeles!');
            }).catch(err => {
                showToast('Error al copiar el enlace.');
            });
        }
    });

    // --- SECCI√ìN MI CUENTA ---
    const businessNameInput = document.getElementById('businessName');
    const headerBusinessName = document.getElementById('headerBusinessName');
    const logoInput = document.getElementById('logoInput');
    const logoPreview = document.getElementById('logoPreview');
    const headerLogo = document.getElementById('headerLogo');
    const btnGuardarConfig = document.getElementById('btnGuardarConfig');

    // Actualiza el nombre del negocio en el encabezado
    businessNameInput.addEventListener('input', () => {
        headerBusinessName.textContent = businessNameInput.value || '[Nombre del emprendimiento]';
    });

    // Vista previa y actualizaci√≥n del logo
    logoInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                // Mostrar en la vista previa
                logoPreview.src = imageUrl;
                logoPreview.classList.remove('hidden');
                // Mostrar en el encabezado
                headerLogo.src = imageUrl;
                headerLogo.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        } else {
            logoPreview.classList.add('hidden');
            headerLogo.classList.add('hidden');
        }
    });

    // Evento de guardar configuraci√≥n (simulado)
    btnGuardarConfig.addEventListener('click', () => {
        showToast('Configuraci√≥n guardada exitosamente.');
        // Aqu√≠ ir√≠a la l√≥gica para guardar los datos en el backend (Firestore).
    });

    // --- UTILIDADES ---
    const toast = document.getElementById('toast');
    let toastTimeout;
    function showToast(msg){
        clearTimeout(toastTimeout);
        toast.textContent = msg;
        toast.classList.remove('opacity-0', 'translate-y-2');
        toast.classList.add('opacity-100', 'translate-y-0');
        
        toastTimeout = setTimeout(() => {
            toast.classList.remove('opacity-100', 'translate-y-0');
            toast.classList.add('opacity-0', 'translate-y-2');
        }, 2500);
    }

    // --- INICIALIZACI√ìN ---
    aplicarFiltros();
});
</script>
</body>
</html>
