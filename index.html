<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Panel del Cliente</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f7f8fa; --card:#fff; --ink:#2c3e50; --muted:#6b7b8c;
      --pri:#2c7be5; --ok:#27ae60; --warn:#f39c12; --danger:#e74c3c;
      --line:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{background:var(--ink);color:#fff;padding:16px 20px}
    header h1{margin:0;font-size:20px}
    header p{margin:4px 0 0;color:#e5eefb}
    nav{background:#34495e;padding:8px 16px;display:flex;gap:16px}
    nav a{color:#fff;text-decoration:none;font-weight:600;font-size:14px;opacity:.9}
    nav a:hover{opacity:1;text-decoration:underline}
    main{padding:20px;max-width:1200px;margin:auto}
    h2{margin:0 0 12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:16px}
    .acciones{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-bottom:14px}
    .btn{border:1px solid var(--line);background:#fff;padding:9px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .btn:hover{background:#f4f7fb}
    .btn.primary{background:var(--pri);border-color:var(--pri);color:#fff}
    .btn.ghost{background:#fff}
    .btn.small{padding:6px 8px;font-size:12px}
    .filtros{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:6px 0 14px}
    .filtros label{font-size:13px;color:var(--muted)}
    .filtros input,.filtros select{padding:8px;border:1px solid var(--line);border-radius:8px;background:#fff}
    .lote{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:8px 0 10px}
    .lote-left{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .lote-right{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--line);border-radius:10px;overflow:hidden}
    th,td{border-top:1px solid var(--line);padding:10px;text-align:left;font-size:13px;vertical-align:top}
    thead th{background:#f5f7fb;font-size:12px;color:#4e5d6c}
    tbody tr:hover{background:#fafcff}
    .oculto{display:none}
    .badge{padding:3px 8px;border-radius:999px;font-size:12px;font-weight:700;display:inline-block}
    .b-pendiente{background:#fff8e6;color:#8a6100;border:1px solid #ffd27a}
    .b-enviado{background:#e8f2ff;color:#0b57d0;border:1px solid #a7c8ff}
    .b-entregado{background:#e7f7ef;color:#1b7f3a;border:1px solid #bfe7cd}
    .b-reprogramado{background:#fff0f3;color:#a1253a;border:1px solid #ffb9c6}
    .status-select{padding:6px;border:1px solid var(--line);border-radius:8px;background:#fff}
    .toast{position:fixed;right:16px;bottom:16px;background:#111;color:#fff;padding:10px 14px;border-radius:8px;opacity:0;transform:translateY(8px);transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:15px;justify-content:center;">
      <!-- Logo din√°mico -->
      <img id="headerLogo" src="" alt="Logo Emprendimiento" style="height:50px; display:none; border-radius:6px;">

      <!-- T√≠tulo -->
      <div>
        <h1 style="margin:0;">üìã Panel del Control</h1>
        <p style="margin:4px 0 0;color:#e5eefb">Bienvenido, <strong>[Nombre del emprendimiento]</strong></p>
      </div>
    </div>
  </header>

  <nav>
    <a href="#envios">üöÄ Env√≠os</a>
    <a href="#reportes">üìä Reportes</a>
    <a href="#cuenta">‚öôÔ∏è Mi Cuenta</a>
  </nav>

  <main>
    <section class="card" id="envios">
      <h2>üöÄ Mis Env√≠os</h2>

      <!-- Botonera superior -->
      <div class="acciones">
        <button class="btn ghost" id="btnTplShalom">üì• Descargar Plantilla SHALOM</button>
        <button class="btn ghost" id="btnTplDinsides">üì• Descargar Plantilla DINSIDES</button>
        <button class="btn" id="btnEtiquetas">üè∑Ô∏è Imprimir Etiquetas</button>
      </div>

      <!-- Filtros -->
      <div class="filtros">
        <label>Cliente (Celular)
          <input type="text" id="filtroCliente" placeholder="Ej: 987654321" />
        </label>
        <label>Fecha de Env√≠o
          <input type="date" id="filtroFecha" />
        </label>
        <label>Tipo
          <select id="filtroTipo">
            <option value="DELIVERY" selected>DELIVERY</option>
            <option value="SHALOM">SHALOM</option>
            <option value="">Todos</option> <!-- ‚úÖ Nueva opci√≥n -->
          </select>
        </label>

        <button class="btn" id="btnAplicarFiltros">Filtrar</button>
      </div>

      <!-- Acciones en lote -->
      <div class="lote">
        <div class="lote-left">
          <label class="nowrap"><input type="checkbox" id="checkTodos" /> Seleccionar todo</label>
          <span style="color:var(--muted);font-size:13px" id="selCount">0 seleccionados</span>
        </div>
        <div class="lote-right">
          <select id="accionLote" class="status-select">
            <option value="" selected>Acci√≥n en lote‚Ä¶</option>
            <option value="ENVIADO">Marcar como Enviado</option>
            <option value="ENTREGADO">Marcar como Entregado</option>
            <option value="REPROGRAMADO">Reprogramar</option>
          </select>
          <input type="date" id="fechaReprog" class="oculto" />
          <button class="btn primary" id="btnAplicarLote">Aplicar</button>
        </div>
      </div>

      <!-- Tabla -->
      <div style="overflow:auto">
        <table id="tablaEnvios">
          <thead>
            <tr>
              <th style="width:36px"><input type="checkbox" id="thCheckTodos" /></th>
              <th>Fecha de Registro</th>
              <th>Cliente (Celular)</th>
              <th>Tipo</th>
              <th>Nombre</th>
              <th>Tel√©fono</th>
              <th class="col-distrito">Distrito</th>
              <th class="col-direccion">Direcci√≥n</th>
              <th class="col-referencia">Referencia</th>
              <th class="col-dni">DNI/CE</th>
              <th class="col-agencia">Agencia</th>
              <th>Fecha de Env√≠o</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody id="tbodyEnvios">
            <!-- Datos de ejemplo -->
            <tr data-tipo="SHALOM" data-cliente="912345678" data-fechaenvio="2025-08-20">
              <td><input type="checkbox" class="rowCheck" /></td>
              <td>2025-08-18</td>
              <td>912345678</td>
              <td>SHALOM</td>
              <td>Mar√≠a L√≥pez</td>
              <td>912345678</td>
              <td class="col-distrito">-</td>
              <td class="col-direccion">-</td>
              <td class="col-referencia">-</td>
              <td class="col-dni">87654321</td>
              <td class="col-agencia">Lima / Lima / Chorrillos / Chorrillos Los Faisanes</td>
              <td>2025-08-20</td>
              <td class="estado"><span class="badge b-enviado">Enviado</span></td>
            </tr>
            <tr data-tipo="SHALOM" data-cliente="912345678" data-fechaenvio="2025-08-20">
              <td><input type="checkbox" class="rowCheck" /></td>
              <td>2025-08-18</td>
              <td>912345678</td>
              <td>SHALOM</td>
              <td>Mar√≠a L√≥pez</td>
              <td>912345678</td>
              <td class="col-distrito">-</td>
              <td class="col-direccion">-</td>
              <td class="col-referencia">-</td>
              <td class="col-dni">87654321</td>
              <td class="col-agencia">	Ancash / Huaraz / Huaraz / Huaraz</td>
              <td>2025-08-20</td>
              <td class="estado"><span class="badge b-enviado">Enviado</span></td>
            </tr>
            <tr data-tipo="DELIVERY" data-cliente="987654321" data-fechaenvio="2025-08-22">
              <td><input type="checkbox" class="rowCheck" /></td>
              <td>2025-08-20</td>
              <td>987654321</td>
              <td>DELIVERY</td>
              <td>Juan P√©rez</td>
              <td>987654321</td>
              <td class="col-distrito">Lima</td>
              <td class="col-direccion">Av. Principal 123</td>
              <td class="col-referencia">Frente al parque</td>
              <td class="col-dni">-</td>
              <td class="col-agencia">-</td>
              <td>2025-08-22</td>
              <td class="estado"><span class="badge b-pendiente">Pendiente</span></td>
            </tr>
            <tr data-tipo="DELIVERY" data-cliente="900111222" data-fechaenvio="2025-08-23">
              <td><input type="checkbox" class="rowCheck" /></td>
              <td>2025-08-21</td>
              <td>900111222</td>
              <td>DELIVERY</td>
              <td>Pedro Rojas</td>
              <td>900111222</td>
              <td class="col-distrito">Miraflores</td>
              <td class="col-direccion">Calle 9 #456</td>
              <td class="col-referencia">2do piso</td>
              <td class="col-dni">-</td>
              <td class="col-agencia">-</td>
              <td>2025-08-23</td>
              <td class="estado"><span class="badge b-pendiente">Pendiente</span></td>
            </tr>

          </tbody>
        </table>
      </div>
    </section> 
    
  </main>

  <div class="toast" id="toast">Acci√≥n aplicada</div>

  <script>
    const filtroTipo = document.getElementById('filtroTipo');
    const filtroCliente = document.getElementById('filtroCliente');
    const filtroFecha = document.getElementById('filtroFecha');
    const btnAplicarFiltros = document.getElementById('btnAplicarFiltros');

    const fechaReprog = document.getElementById('fechaReprog');
    const accionLote = document.getElementById('accionLote');
    const btnAplicarLote = document.getElementById('btnAplicarLote');

    const tbody = document.getElementById('tbodyEnvios');
    const checkTodos = document.getElementById('checkTodos');
    const thCheckTodos = document.getElementById('thCheckTodos');
    const selCount = document.getElementById('selCount');
    const toast = document.getElementById('toast');

    // ---------- Columnas din√°micas por tipo + filtrado de filas ----------
    function aplicarFiltros() {
      const tipo = filtroTipo.value;
      const cel = filtroCliente.value.trim().toLowerCase();
      const fecha = filtroFecha.value; // yyyy-mm-dd

      // Mostrar todas las columnas primero
      document.querySelectorAll('.col-distrito,.col-direccion,.col-referencia,.col-dni,.col-agencia')
        .forEach(el => el.classList.remove('oculto'));

      // Ocultar columnas seg√∫n tipo
      if (tipo === 'DELIVERY') {
        document.querySelectorAll('.col-dni,.col-agencia').forEach(el => el.classList.add('oculto'));
      } else if (tipo === 'SHALOM') {
        document.querySelectorAll('.col-distrito,.col-direccion,.col-referencia').forEach(el => el.classList.add('oculto'));
      }

      // Filtrar filas por tipo + cliente + fecha de env√≠o
      [...tbody.rows].forEach(tr => {
        const t = tr.dataset.tipo || '';
        const c = (tr.dataset.cliente || '').toLowerCase();
        let f = tr.dataset.fechaenvio || '';

        // Recortar ISO con "T" si viniera as√≠
        if (typeof f === 'string' && f.includes('T')) f = f.split('T')[0];

        const okTipo = (tipo === '' || t === tipo);     // si quisieras "Todos" usa opci√≥n vac√≠a
        const okCli  = (cel === '' || c.includes(cel));
        const okFec  = (fecha === '' || f === fecha);

        tr.style.display = (okTipo && okCli && okFec) ? '' : 'none';
      });

      // Al cambiar filtros, limpia selecci√≥n
      deseleccionarTodo();
    }

    // ---------- Selecci√≥n m√∫ltiple ----------
    function contarSeleccionados(){
      const count = document.querySelectorAll('.rowCheck:checked').length;
      selCount.textContent = count + ' seleccionados';
    }
    function seleccionarTodo(checked){
      document.querySelectorAll('.rowCheck').forEach(cb => {
        const row = cb.closest('tr');
        if (row.style.display !== 'none') cb.checked = checked; // solo visibles
      });
      thCheckTodos.checked = checked;
      checkTodos.checked = checked;
      contarSeleccionados();
    }
    function deseleccionarTodo(){ seleccionarTodo(false); }

    checkTodos.addEventListener('change', e => seleccionarTodo(e.target.checked));
    thCheckTodos.addEventListener('change', e => seleccionarTodo(e.target.checked));
    tbody.addEventListener('change', e => { if(e.target.classList.contains('rowCheck')) contarSeleccionados(); });

    // ---------- Acci√≥n en lote ----------
    accionLote.addEventListener('change', () => {
      const v = accionLote.value;
      fechaReprog.classList.toggle('oculto', v !== 'REPROGRAMADO');
      if (v !== 'REPROGRAMADO') fechaReprog.value = '';
    });

    btnAplicarLote.addEventListener('click', () => {
      const action = accionLote.value;
      if (!action){ showToast('Elige una acci√≥n en lote'); return; }

      if (action === 'REPROGRAMADO' && !fechaReprog.value){
        showToast('Selecciona fecha para reprogramar'); return;
      }

      const seleccionados = [...document.querySelectorAll('.rowCheck:checked')].map(cb => cb.closest('tr'));
      if (seleccionados.length === 0){ showToast('No hay env√≠os seleccionados'); return; }

      // ‚ÄúAplicar‚Äù visualmente en la tabla (mock)
      seleccionados.forEach(tr => {
        const tdEstado = tr.querySelector('.estado');
        if (action === 'ENVIADO') {
          tdEstado.innerHTML = '<span class="badge b-enviado">Enviado</span>';
        } else if (action === 'ENTREGADO') {
          tdEstado.innerHTML = '<span class="badge b-entregado">Entregado</span>';
        } else if (action === 'REPROGRAMADO') {
          // Actualiza fecha de env√≠o + estado
          tr.dataset.fechaenvio = fechaReprog.value;
          tr.cells[11].textContent = fechaReprog.value; // Columna "Fecha de Env√≠o"
          tdEstado.innerHTML = '<span class="badge b-reprogramado">Reprogramado</span>';
        }
      });

      showToast('Acci√≥n aplicada a ' + seleccionados.length + ' env√≠o(s)');
      deseleccionarTodo();

      // üëâ Aqu√≠ tu socio debe:
      // - Enviar los IDs/filas seleccionadas + acci√≥n + (fechaReprog si aplica) al backend (Apps Script / API)
      // - Actualizar Google Sheets y responder con √©xito/errores
    });

    // ---------- Botones de plantillas / etiquetas (mock) ----------
    document.getElementById('btnTplShalom').onclick   = () => showToast('Descargando plantilla SHALOM...');
    document.getElementById('btnTplDinsides').onclick = () => showToast('Descargando plantilla DINSIDES...');
    document.getElementById('btnEtiquetas').onclick   = () => showToast('Abriendo impresor de etiquetas...');

    // ---------- Utilidades ----------
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), 2000);
    }

    // Estado inicial: filtrar por DELIVERY
    btnAplicarFiltros.addEventListener('click', aplicarFiltros);
    window.addEventListener('load', aplicarFiltros);
  
    // Mostrar vista previa del logo y actualizar el header
    const logoInput = document.getElementById("logoInput");
    const logoPreview = document.getElementById("logoPreview");
    const headerLogo = document.getElementById("headerLogo");

    logoInput.addEventListener("change", function() {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          logoPreview.src = e.target.result;
          logoPreview.style.display = "block";

          // ‚úÖ Actualizar logo en el header
          headerLogo.src = e.target.result;
          headerLogo.style.display = "block";
        };
        reader.readAsDataURL(file);
      } else {
        logoPreview.style.display = "none";
        headerLogo.style.display = "none";
      }
    });
  
  </script>
</body>
</html>
